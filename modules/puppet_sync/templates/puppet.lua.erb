settings {
  logfile = '/var/log/lsyncd/puppet.log',
  statusFile = '/var/run/lsyncd/puppet.status',
}
<% @targets.each do |target| -%>

sync {
  default.rsyncssh,
  source = "/etc/puppetlabs/code",
  host = "<%= target %>",
  targetdir = "/etc/puppetlabs/code",
  rsync = {
    archive = true,
    checksum = true,
    compress = true,
  }
}
<% end -%>
