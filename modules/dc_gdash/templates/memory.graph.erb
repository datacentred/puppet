title       "RAM Usage (in percent)"
vtitle "Percent"
area        :stacked
description "RAM usage (in percent)"
hide_legend false
<%
  # Create our hostname string in a format that's consistent with what we're storing in Carbon
  ghostname  = "collectd." + @reversedomain + "." + @_hostname + ".memory.memory"

  memused   = ghostname + ".used" 
  memfree   = ghostname + ".free"
  memcached = ghostname + ".cached"
  membuffed = ghostname + ".buffered"
%>
field :use,    :color => "red",
               :alias => "used by application",
               :data  => "asPercent(diffSeries(<%= memused %>,<%= memcached %>,<%= membuffed %>,sumSeries(<%= memused %>,<%= memfree %>))"

field :buffer, :color => "orange",
               :alias => "buffer",
               :data  => "asPercent(<%= membuffed %>,sumSeries(<%= memused %>,<%= memfree %>))"

field :cache,  :color => "yellow",
               :alias => "cache",
               :data  => "asPercent(<%= memcached %>,sumSeries(<%= memused %>,<%= memfree %>))"

field :free,   :color => "green",
               :alias => "free",
               :data  => "asPercent(<%= memfree %>,sumSeries(<%= memused %>,<%= memfree %>))"

