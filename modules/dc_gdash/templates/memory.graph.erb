title       "RAM Usage (in percent)"
area        :stacked
description "RAM usage (in percent)"
hide_legend false
<%
  # Create our hostname string in a format that's consistent with what we're storing in Carbon
  ghostname  = (@_hostname + "." + @domain).gsub(/\./, '_')  
  memused   = "collectd." + ghostname + ".memory.memory-used" 
  memfree   = "collectd." + ghostname + ".memory.memory-free"
  memcached = "collectd." + ghostname + ".memory.memory-cached"
  membuffed = "collectd." + ghostname + ".memory.memory-buffered"
%>
field :use,    :color => "red",
               :alias => "used by application",
               :data  => "asPercent(diffSeries(<%= memused %>,<%= memcached %>,<%= membuffed %>,sumSeries(<%= memused %>,<%= memfree %>))"

field :buffer, :color => "orange",
               :alias => "buffer",
               :data  => "asPercent(<%= membuffed %>,sumSeries(<%= memused %>,<%= memfree %>))"

field :cache,  :color => "yellow",
               :alias => "cache",
               :data  => "asPercent(<%= memcached %>,sumSeries(<%= memused %>,<%= memfree %>))"

field :free,   :color => "green",
               :alias => "free",
               :data  => "asPercent(<%= memfree %>,sumSeries(<%= memused %>,<%= memfree %>))"

