#!/bin/bash

if grep -q <%= @mountpoint %> /proc/mounts
then
    echo "Mountpoint shouldn't be mounted yet - trying to unmount"
    if ! umount <%= @mountpoint %>
    then
        echo "Backup umount failed"
        exit 1
    fi
else
    if ! mount <%= @mountpoint %>
    then
        echo "Backup mount failed"
        exit 1
    else
        if ! ceph auth list > <%= @mountpoint %>/keys
        then
            echo "Backup failed"
            exit 1
        else
            if ! umount <%= @mountpoint %>
            then
                echo "Backup unmount failed"
            fi
        fi
    fi
fi



